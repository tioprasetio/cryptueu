<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptUEU | RSA Encryption & Decryption UEU</title>
    <!-- <link rel="stylesheet" href="assets/css/twokey.css" /> -->
    <!--=============== REMIXICONS ===============-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css" rel="stylesheet">
    <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/128/4413/4413865.png" type="image/x-icon">
</head>

<body>
    <div class="container">
        <div id="customAlert" class="alert hidden">
            <span id="alertMessage">Pesan notifikasi</span>
            <a class="close-btn" onclick="hideAlert()">
                <i class="ri-close-line"></i>
            </a>
        </div>

        <h1 class="judul">RSA Encryption & Decryption UEU</h1>

        <div class="input-group">
            <label for="prime-p"><i class="fa-solid fa-square-root-alt"></i> Bilangan Prima p:</label>
            <input type="number" id="prime-p" placeholder="Masukkan bilangan prima p (min: 11)">
        </div>
        <div class="input-group">
            <label for="prime-q"><i class="fa-solid fa-square-root-alt"></i> Bilangan Prima q:</label>
            <input type="number" id="prime-q" placeholder="Masukkan bilangan prima q (min: 11)">
        </div>

        <div class="input-group">
            <button onclick="generateKeys()"><i class="fa-solid fa-key"></i> Buat kunci RSA</button>
        </div>

        <div class="input-group">
            <label><i class="fa-solid fa-globe"></i> Public Key:</label>
            <textarea id="public-key" readonly></textarea>
        </div>

        <div class="input-group">
            <label><i class="fa-solid fa-shield-halved"></i> Private Key:</label>
            <textarea id="private-key" readonly></textarea>
        </div>

        <hr>

        <h2 class="judul">Enkripsi</h2>
        <div class="input-group">
            <label for="text"><i class="fa-solid fa-pen-to-square"></i> Masukkan Text:</label>
            <textarea id="text" placeholder="Masukkan text yang akan dienkripsi"></textarea>
        </div>
        <div class="input-group">
            <label><i class="fa-solid fa-globe"></i> Public Key:</label>
            <textarea id="encryption-public-key"></textarea>
        </div>
        <div class="input-group">
            <button onclick="encryptData()"><i class="fa-solid fa-lock"></i> Enkripsi</button>
        </div>
        <div class="input-group">
            <label><i class="fa-solid fa-lock"></i> Hasil Enkripsi:</label>
            <textarea id="encrypted-output" readonly></textarea>
        </div>

        <hr>

        <h2 class="judul">Dekripsi</h2>
        <div class="input-group">
            <label for="encrypted-input"><i class="fa-solid fa-lock"></i> Pesan Terenkripsi:</label>
            <textarea id="encrypted-input" placeholder="Isikan pesan terenkripsi disini"></textarea>
        </div>
        <div class="input-group">
            <label for="decrypt-private-key"><i class="fa-solid fa-shield-halved"></i> Private Key:</label>
            <textarea id="decrypt-private-key" placeholder="Masukkan Private Key"></textarea>
        </div>
        <div class="input-group">
            <button onclick="decryptData()"><i class="fa-solid fa-lock-open"></i> Dekripsi</button>
        </div>
        <div class="input-group">
            <label><i class="fa-regular fa-square-check"></i> Hasil Dekripsi:</label>
            <textarea id="decrypted-output" readonly></textarea>
        </div>
        <div class="input-group">
            <button class="reset" onclick="reset()"><i class="fa-solid fa-repeat"></i> Muat Ulang</button>
        </div>
    </div>

    <footer>
        <span>&#169; 2024 Kriptografi Fasilkom <b><a href="https://www.instagram.com/univ.esaunggul_bekasi"
                    target="_blank">Univ.Esa
                    Unggul Bekasi.</a></b> All right reserved.</span>
    </footer>

    <style>
        *,
html,
body {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: Arial, sans-serif;
}

a {
  text-decoration: none;
  color: inherit;
}

::-webkit-scrollbar {
  display: none;
}

/* Gaya dasar untuk alert */
.alert {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  max-width: 90%;
  width: 100%;
  padding: 15px 20px;
  background-color: #369139; /* Warna hijau untuk sukses */
  color: white;
  font-size: 16px;
  font-family: Arial, sans-serif;
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
  z-index: 9999;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: transform 0.3s ease, opacity 0.3s ease;
}

/* Tersembunyi secara default */
.hidden {
  opacity: 0;
  transform: translateX(-50%) translateY(-20px);
  pointer-events: none;
}

/* Tombol close */
.close-btn {
  background: none;
  border: none;
  color: white;
  font-size: 18px;
  cursor: pointer;
}

/* Gaya untuk jenis notifikasi lainnya */
.alert.success {
  background-color: #4caf50; /* Hijau */
}

.alert.error {
  background-color: #f44336; /* Merah */
}

.alert.info {
  background-color: #2196f3; /* Biru */
}

.alert.warning {
  background-color: #ff9800; /* Oranye */
}

.judul {
  margin-bottom: 15px;
}

.container {
  max-width: 700px;
  margin: auto;
  padding: 20px 20px 50px 20px;
}

.input-group {
  margin-bottom: 20px;
}

.input-group label {
  font-weight: bold;
}

.input-group textarea,
.input-group input {
  width: -webkit-fill-available;
  padding: 10px;
  margin-top: 10px;
  border: 1px solid #ccc;
  border-radius: 5px;
}

button {
  margin: 10px 5px 0 0;
  padding: 10px 15px;
  width: 100%;
  border: none;
  border-radius: 5px;
  background-color: #007bff;
  color: white;
  font-size: 16px;
  cursor: pointer;
}

button:hover {
  background-color: #004997;
}

button.reset {
  background-color: #dc3545;
}

button.reset:hover {
  background-color: #a01c2a;
}

textarea {
  resize: vertical;
  min-height: 100px;
}

select {
  padding: 10px;
  margin-top: 5px;
  width: 100%;
}
footer {
  text-align: center;
  position: fixed;
  left: 0;
  bottom: 0;
  width: 100%;
  padding: 10px;
  background-color: #fff;
  font-size: 14px;
}
hr {
  margin-bottom: 20px;
}

    </style>

    <script>
        // Fungsi notifikasi sukses
            function showAlert(message, type = "success") {
                const alertBox = document.getElementById("customAlert");
                const alertMessage = document.getElementById("alertMessage");

                // Pilih ikon berdasarkan tipe
                const icon =
                    type === "success"
                        ? '<i class="ri-checkbox-circle-line"></i>&nbsp;'
                        : '<i class="ri-close-circle-line"></i>&nbsp;';

                // Set pesan dengan ikon
                alertMessage.innerHTML = `${icon}${message}`;
                alertBox.className = `alert ${type}`; // Tambahkan kelas tipe
                alertBox.classList.remove("hidden"); // Tampilkan alert

                // Sembunyikan alert secara otomatis setelah 3 detik
                setTimeout(hideAlert, 3000);
            }

            // Fungsi menyembunyikan notifikasi
            function hideAlert() {
                const alertBox = document.getElementById("customAlert");
                alertBox.classList.add("hidden");
            }

            let publicKey, privateKey;

            // Fungsi untuk menghitung GCD
            function gcd(a, b) {
                while (b) {
                    [a, b] = [b, a % b];
                }
                return a;
            }

            function isPrime(num) {
                if (num <= 1) return false; // Bilangan <= 1 bukan bilangan prima
                for (let i = 2; i <= Math.sqrt(num); i++) {
                    if (num % i === 0) return false; // Jika habis dibagi, bukan bilangan prima
                }
                return true; // Jika lolos semua pengecekan, bilangan prima
            }

            // START MEMBUAT KUNCI RSA
            async function generateKeys() {
                console.clear();
                try {
                    // Ambil nilai p dan q dari input
                    const p = parseInt(document.getElementById("prime-p").value.trim());
                    const q = parseInt(document.getElementById("prime-q").value.trim());

                    if (isNaN(p) || isNaN(q)) {
                        showAlert("Nilai p dan q tidak boleh kosong", "error");
                        return;
                    }

                    if (isNaN(p) || p < 11) {
                        showAlert("Inputan harus bernilai minimal 11", "error");
                        return;
                    }

                    if (q < p && q < 11) {
                        showAlert(
                            "Nilai q tidak boleh lebih kecil dari p jika nilainya di bawah 11",
                            "error"
                        );
                        return;
                    }

                    // Validasi jika p dan q sama
                    if (p === q) {
                        showAlert("Nilai p dan q tidak boleh sama", "error");
                        return;
                    }

                    // Validasi apakah p dan q adalah bilangan prima, jika tudak naka error
                    if (!isPrime(p)) {
                        showAlert("Nilai p harus bilangan prima", "error");
                        return;
                    }

                    if (!isPrime(q)) {
                        showAlert("Nilai q harus bilangan prima", "error");
                        return;
                    }

                    // Hitung nilai n dan m
                    const n = p * q; // n = p * q
                    const m = (p - 1) * (q - 1); // m = (p-1) * (q-1)

                    // Pilih nilai e secara dinamis yang memenuhi gcd(e, m) = 1
                    let e = 0;
                    for (let i = 2; i < m; i++) {
                        if (gcd(i, m) === 1) {
                            e = i;
                            break; // Temukan e yang valid dan keluar dari loop
                        }
                    }

                    // Jika tidak ada nilai e yang valid, akan error
                    if (e === 0) {
                        showAlert("Tidak dapat menemukan nilai e yang valid", "error");
                        return;
                    }

                    // Hitung nilai d
                    let d = 1;
                    while ((d * e) % m !== 1) {
                        d++;
                    }

                    // Simpan kunci
                    publicKey = { e, n };
                    privateKey = { d, n };

                    // Tampilkan kunci ke pengguna
                    document.getElementById("public-key").value = `e: ${e}, n: ${n}`;
                    document.getElementById("private-key").value = `d: ${d}, n: ${n}`;

                    console.log("Detail Kunci RSA:");
                    console.log(`n (p * q): ${n}`);
                    console.log(`m ((p - 1) * (q - 1)): ${m}`);
                    console.log(
                        `Kunci Public (e): ${e} (bilangan terkecil yang relatif prima dengan m=${m})`
                    );
                    console.log(
                        `Kunci Private (d): ${d} (nilai d yang memenuhi (d * e) % m = 1)`
                    );

                    showAlert("Jaga kerahasiaan Private key ya! enjoy", "success");
                } catch (error) {
                    showAlert(
                        "Terjadi kesalahan saat membuat kunci RSA. Silakan coba lagi",
                        "error"
                    );
                    console.error(error);
                }
            }
            // END MEMBUAT KUNCI RSA

            // START ENKRIPSI DATA
            function encryptData() {
                try {
                    const inputPublicKey = document
                        .getElementById("encryption-public-key")
                        .value.trim();
                    const text = document.getElementById("text").value.trim();
                    if (!text) {
                        showAlert("Mohon masukkan text yang akan dienkripsi", "error");
                        return;
                    }

                    if (!inputPublicKey) {
                        showAlert("Mohon masukkan Public Key untuk proses Enkripsi", "error");
                        return;
                    }

                    // Memvalidasi format public key: Harus sesuai dengan format "e: nilai, n: nilai"
                    const publicKeyPattern = /^e:\s*\d+\s*,\s*n:\s*\d+$/;
                    if (!publicKeyPattern.test(inputPublicKey)) {
                        showAlert(
                            "Format Public Key tidak valid. Harus sesuai dengan format 'e: nilai, n: nilai'",
                            "error"
                        );
                        return;
                    }

                    const { e, n } = publicKey;
                    const bigN = BigInt(n); // Konversi ke BigInt
                    const bigE = BigInt(e);

                    const charCodes = Array.from(text).map((char) =>
                        BigInt(char.charCodeAt(0))
                    );
                    const encrypted = charCodes.map((code) => (code ** bigE % bigN).toString());

                    document.getElementById("encrypted-output").value = encrypted.join(",");

                    console.clear();

                    // Cetak langkah-langkah enkripsi ke console biar aman
                    console.log("Langkah-langkah Enkripsi:");
                    console.log("ASCII dari plaintext:", charCodes.join(", "));
                    charCodes.forEach((code, index) => {
                        console.log(
                            `Karakter '${text[index]}' -> ASCII(${code}) -> Enkripsi: (${code}^${bigE} mod ${bigN}) = ${encrypted[index]}`
                        );
                    });
                    console.log("Hasil Enkripsi:", encrypted.join(", "));

                    showAlert("Selamat! Pesan kamu sekarang terenkripsi", "success");
                } catch (error) {
                    showAlert(
                        "Terjadi kesalahan saat Enkripsi. Pastikan kunci Public valid",
                        "error"
                    );
                    console.error(error);
                }
            }

            // END ENKRIPSI DATA

            // START DEKRIPSI DATA
            function decryptData() {
                try {
                    const encryptedText = document
                        .getElementById("encrypted-input")
                        .value.trim();
                    const inputPrivateKey = document
                        .getElementById("decrypt-private-key")
                        .value.trim();

                    if (!encryptedText) {
                        showAlert("Masukkan teks terenkripsi", "error");
                        return;
                    }

                    if (!inputPrivateKey) {
                        showAlert("Mohon masukkan Private Key untuk proses Dekripsi", "error");
                        return;
                    }

                    // Memvalidasi format public key: Harus sesuai dengan format "d: nilai, n: nilai"
                    const privateKeyPattern = /^d:\s*\d+\s*,\s*n:\s*\d+$/;
                    if (!privateKeyPattern.test(inputPrivateKey)) {
                        showAlert(
                            "Format Private Key tidak valid. Harus sesuai dengan format 'd: nilai, n: nilai'",
                            "error"
                        );
                        return;
                    }

                    const encryptedArray = encryptedText.split(",").map((code) => BigInt(code));
                    const { d, n } = privateKey;
                    const bigN = BigInt(n); // Konversi ke BigInt
                    const bigD = BigInt(d);

                    const decrypted = encryptedArray
                        .map((code) => Number(code ** bigD % bigN))
                        .map((code) => String.fromCharCode(code))
                        .join("");

                    document.getElementById("decrypted-output").value = decrypted;

                    console.clear();

                    // Cetak langkah-langkah dekripsi ke console biar aman
                    console.log("Langkah-langkah Dekripsi:");
                    console.log("Teks terenkripsi:", encryptedArray.join(", "));
                    encryptedArray.forEach((code, index) => {
                        const ascii = Number(code ** bigD % bigN);
                        console.log(
                            `Elemen terenkripsi ${code} -> Dekripsi: (${code}^${bigD} mod ${bigN}) = ASCII(${ascii}) -> Karakter: '${String.fromCharCode(
                                ascii
                            )}'`
                        );
                    });
                    console.log("Hasil Dekripsi:", decrypted);

                    showAlert("Selamat! Pesan kamu berhasil didekripsi", "success");

                } catch (error) {
                    showAlert("Pastikan teks terenkripsi dan Private Key benar", "error");
                    console.error(error);
                }
            }

            // END DEKRIPSI DATA

            // START FUNGSI MUAT ULANG
            function reset() {
                document.getElementById("text").value = "";
                document.getElementById("prime-p").value = "";
                document.getElementById("prime-q").value = "";
                document.getElementById("public-key").value = "";
                document.getElementById("private-key").value = "";
                document.getElementById("encryption-public-key").value = "";
                document.getElementById("encrypted-output").value = "";
                document.getElementById("encrypted-input").value = "";
                document.getElementById("decrypt-private-key").value = "";
                document.getElementById("decrypted-output").value = "";
                console.clear();

                showAlert("Semua inputan sudah berhasil dibersihkan. Enjoy!", "success");
            }
            // END FUNGSI MUAT ULANG

            // MENJALANKAN ALERT PANDUAN PENGGUNAAN KETIKA LOAD
            document.addEventListener("DOMContentLoaded", function () {
                Swal.fire({
                    title: "Panduan Penggunaan",
                    html: `
        <ul style="text-align: left; list-style: disc; margin-left: 20px;">
          <li>Inputkan <b>bilangan prima P</b> dan <b>bilangan prima q</b>.</li>
          <li>Generate kunci RSA dengan klik tombol <b>"Buat kunci RSA"</b> untuk mendapatkan public dan private key.</li>
          <li>Masukkan pesan pada kolom <b>"Masukkan Text"</b> untuk dienkripsi.</li>
          <li>Klik tombol <b>"Enkripsi"</b> untuk menghasilkan teks terenkripsi.</li>
          <li>Untuk dekripsi, masukkan teks terenkripsi dan private key anda pada kolom yang sesuai.</li>
          <li>Klik tombol <b>"Dekripsi"</b> untuk mendapatkan teks asli.</li>
        </ul>
      `,
                    icon: "info",
                    confirmButtonText: "Mengerti",
                });
            });

    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>

</html>